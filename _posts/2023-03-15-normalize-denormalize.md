---
title: 정규화냐 비정규화냐 그것이 문제로다
author: guaqamole
date: 2023-03-15 18:32:00 +0900
categories: [Data, DW]
tags: [DBMS, Design, Kimball, Dimensional Modeling]
image:
  path: /common/books/data_warehouse_toolkit.jpeg
---

Data Engineer는 B2B 기업에서 성장하기 힘들다는 판단을 하여 자신만의 서비스를 직접 운영하는 e-commerce 기업으로 이직했다. 오자마자 엄청난 Role을 부여받아 조금 긴장되고 떨리지만.. 처음으로 내 성과를 보여줄 수 있는 기회이기도 하니 열심히 할거다. 

회사에서 직접 작성한 나의 `Confluence` 글을 그대로 가져와봤다. 앞으로 전사적으로 사용할 DW를 구축하기전에 팀내 엔지니어 분들께 다차원 모델링 (Dimension Modeling) 소개하고자 글을 작성해보았다.  

<br>

****

DW를 모델링 하다보면 Star Schema와 Snowflake Schema중 어느 모델이 비즈니스에 더 적합할지 고민을하게 됩니다. 이는 데이터를  “*정규화 할것인지, 비정규화 할건지* ” 와 같은 질문입니다. 

20년 전 만해도 데이터를 효율적으로 저장하고, 비교적 관리하기가 쉬운 Snowflake Schema인가, 유저의 편의성과 성능을 둘다 잡을 수 있는 Star Schema인가에 대해 논점이 정말 많았습니다. 심지어 DB 벤더사들은 자신들이 개발한 데이터 베이스가 정규화된 테이블을 조인 할 때 성능에 대한 페널티가 없다며 자신들의 기술력을 “과시” 하고 치열하게 경쟁 했었습니다. 정규화된 데이터 속에서 성능에 대한 부분을 최적화 수 있다면 그것도 *Good Case* 라고 생각하지만, 데이터의 가치가 예전과 같지 않은 오늘날, BI 어플리케이션 유저들은 복잡한 데이터의 구조를 **선호하지 않는다**는것을 잊지 말아야합니다.

Data Warehousing Architect의 대가인 [Ralph Kimball](https://en.wikipedia.org/wiki/Ralph_Kimball)은 대부분의 비즈니스 프로세스는 20개 보다 적은 디멘션 테이블로 구성이 가능하다고 주장합니다. 개인적으로 저 주장이 무리가 있다고 생각하지만, 킴벌이 말하고자 하는것은 **상호 관계를 나타내는 디멘션 테이블을 하나의 디멘션으로 합칠 수 있도록 방법을 항시 찾아야 한다**는 뜻입니다.

 <br>

킴벌은 디멘션 테이블을 보다 효과적으로 디자인 하기위해 *Four-Step Dimensional Design Process* 를 제시합니다.

## Step 1. 비즈니스 프로세스 파악

스키마를 설계하기 전 가장 중요한 스텝은 **비즈니스 프로세스에 대한 이해**입니다. 비즈니스 프로세스는 *주문 처리*, *거래내역 작성*, *결제 처리*, *서비스 요청 처리*, *고객 아이디 등록*, *의료 절차 수행*, *보험 청구* 와 같은 조직 내에서 수행되는 `low-level activity` 를 말합니다. 

모델링 수행시 그룹 단위 보다는 **프로세스에 집중**함으로써 조직 전반에 걸쳐 일관된(Consistent) 정보를 효율적으로 전달할 수 있습니다. 큰 그림으로 다차원 모델을 설계하면 중복 데이터가 불가피하게 발생할 확률이 증가합니다. 또한, 일관성을 보장 할 수 있도록 데이터를 한 번에 *공개하는 것이 가장 좋은 방법입니다.

*공개(Publish) : 다른 부서가 분석에 활용 할 수 있는 정제된 Research Data를 오픈하는 행위

<br>

## Step 2. Grain 선언

그레인(Grain)을 선언한다는 것은 **한개의 팩트 테이블 행(row)이 정확히 무엇을 나타내는지를 정의하는 것을 의미합니다.** 쉽게 풀어서 설명하면, "팩트 테이블의 하나의 행을 어떻게 설명 하실건가요?” 에 대한 답변입니다. 좀 더 명확하게 정의하고자, 다음 예시를 참고하시면 좋을 것 같습니다:

- 마트에서 하나의 제품을 스캔할 때마다 하나의 행을 어떻게 구성할것인가?
- 의사의 소견서에서 각 라인의 항목당 하나의 행을 어떻게 구성할것인가?
- 공항 게이트에서 탑승권을 스캔할 때마다 하나의 행을 어떻게 구성할것인가?
- 창고 물류에 대한 일일 재고를 스캔할 때마다 하나의 행을 어떻게 구성할것인가?
- 은행 계좌를 신설할 때마다 하나의 행을 어떻게 구성할것인가?

위와같은 질문을 던져보면서 `Granularity`를 설정한 다음, 다음 스텝으로 넘어가면 될것같습니다.

<br>

## Step 3. 디멘션 식별

*Dimension* 이란 말 그대로 **차원**이라는 뜻입니다. 초등학교 수학시간 때 배웠던 1차원 점, 2차원 선과 같은 비슷한 개념인데 데이터의 공통된 부분에 대한 “속성” 이라고 생각하면 될것같습니다.

`Granularity`를 이전 스텝에서 명확하게 정의 했다면, 디멘션은 이벤트와 관련된 "누가, 무엇을, 언제, 어디서, 왜, 어떻게"를 나타내므로 쉽게 식별할 수 있습니다. 예시로:

- 날짜
- 상품
- 고객
- 직원
- 시설

등이 있습니다. 위와같은 속성, 즉 **차원**을 선택 하면 디멘션 테이블을 구성하는 모든 이산적이고(discrete), 문자 형식의 애트리뷰트를 나열하기가 수월해집니다.

<br>

## Step 4. 팩트 식별

해당 스텝에서 말하는 팩트란, 어떤 사실에 대한 근거가 아닌 **비즈니스 프로세스에서 측정 할 수 있는 숫자적 수치**를 말합니다. 쉽게 풀어서 설명하면, “비즈니스 프로세스가 무엇을 측정하는가?” 에 대해 답변 하는것과 같습니다. BI 시스템을 사용하는 유저들은 대부분 이러한 지표를 분석하는데 매우 관심이 있기 때문에, **디멘션을 기반으로 팩트를 명확하게 식별하여 유의미한 지표를 만들어내는것이 저희 DA Lab의 역할이자 목표**입니다. 

팩트가 될만한 수치들은 스텝2에서 명시한 `Grain`에 특히나 신경을 써야합니다. 만약 내가 선택한 팩트가 해당 테이블의 `Granularity`에 비해 낮거나 높다면, **다른 팩트 테이블을 별도로 만들어 구성하는 방법도 고려**해야합니다.

![img](/230215normalize/1.png)

Kimball, R., & Ross, M. (2013). *The Data Warehouse Toolkit: The Definitive Guide to Dimensional Modeling*. Wiley. Pg.72

지금까지 네가지 스텝을 하나씩 살펴보았는데, 대부분 이 모든 스텝을 고려하지 않고 소스 데이터만 보고 모델링을 진행하는 경우가 많습니다. **하지만 모델을 설계 할 때 단순히 데이터만 보고 모델을 설계하는건 바람직한 방법이 아닙니다.** 모델을 좀 더 빠르게 설계 할 수 있다는 장점이 있지만, 위 그림처럼 다음 두가지를 항상 상응하며 고려해야합니다: 

> *비즈니스 고객이 무엇을 요구하는지?*  vs *현재 데이터가 현실적으로 비즈니적 가치를 만들 수 있는 수준인지?* 

고객을 한명씩 만나보며 요구사항을 물어보는것보다 데이터를 보며 바로 모델링에 뛰어드는것이 실속있다고 생각할 수 있습니다. 하지만, 이전부터 여러 조직이 이러한 쉬운 접근법으로 데이터 중심적인 접근을 시도했지만, 성공하지 못한 경우가 대다수입니다. **데이터는 비즈니스 가치를 만들어내지 못하면 그저 바이트 조각에 불가합니다.**